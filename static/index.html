<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>OCR URL List</title>
</head>
<body>
  <h2>OCR 输入 URL 列表</h2>
  <textarea id="urlList" rows="10" cols="80" placeholder="每行一个图片 URL"></textarea>
  <br><br>
  <button id="submitBtn" onclick="submitOCR()">Go OCR</button>
  <pre id="result" style="white-space: pre-wrap; word-wrap: break-word;"></pre>

  <script>
    async function submitOCR() {
    const btn = document.getElementById('submitBtn');
    const resultEl = document.getElementById('result');

    // ===== 进入 loading 状态 =====
    btn.disabled = true;
    const originalText = btn.textContent;
    btn.textContent = 'OCR 处理中...';
    resultEl.textContent = '';

    try {
      const urls = document.getElementById('urlList').value
        .split('\n')
        .map(u => u.trim())
        .filter(u => u);

      if (urls.length === 0) {
        throw new Error('请输入至少一个图片 URL');
      }

      const response = await fetch('/ocr/ocr', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ urls })
      });

      if (!response.ok) {
        throw new Error(`HTTP ${response.status}`);
      }

      const data = await response.json();
      if (data.texts) {
        resultEl.textContent = JSON.stringify(data.texts, null, 2);
      } else {
        resultEl.textContent = JSON.stringify(data.raw, null, 2);
      }

    } catch (err) {
      resultEl.textContent = '❌ 请求失败: ' + err.message;
    } finally {
      // ===== 退出 loading 状态 =====
      btn.disabled = false;
      btn.textContent = originalText;
    }
  }
  </script>
</body>
</html>